---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const posts = allPosts
  .map((post) => ({
    slug: post.data.slug,
    title: post.data.title,
    date: post.data.date,
    excerpt: post.data.excerpt,
    readingTime: post.data.readingTime,
    category: post.data.category,
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

function formatDate(dateString: string) {
  return new Date(dateString).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}

const base = import.meta.env.BASE_URL || '/';
---

<Layout title="Minh-Ha Nguyen | Research Blog">
  <div class="intro">
    <h1 class="intro-title">Research Blog</h1>
    <p class="intro-text">
      I'm a pharmacoepidemiologist researching medication safety and clinical outcomes. 
      This blog explains my research in clear, accessible terms â€” exploring what the evidence 
      really means for patients and clinicians.
    </p>
  </div>

  <section class="posts-section">
    <h2 class="section-title">Latest Posts</h2>
    <ul class="post-list">
      {posts.map((post) => (
        <li class="post-item">
          <article>
            <div class="post-meta">
              <time class="post-date" datetime={post.date}>{formatDate(post.date)}</time>
              {post.category && <span class="post-category">{post.category}</span>}
            </div>
            <h3 class="post-title">
              <a href={`${base}posts/${post.slug}`}>{post.title}</a>
            </h3>
            <p class="post-excerpt">{post.excerpt}</p>
            <span class="reading-time">{post.readingTime} min read</span>
          </article>
        </li>
      ))}
    </ul>
  </section>
</Layout>

<style>
  .intro {
    text-align: center;
    padding: 2rem 0 3rem;
    border-bottom: 1px solid var(--border);
    margin-bottom: 2rem;
  }

  .intro-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0 0 1rem 0;
    color: var(--text);
  }

  .intro-text {
    font-size: 1.125rem;
    color: var(--text-muted);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.7;
  }

  .posts-section {
    padding: 1rem 0;
  }

  .section-title {
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-light);
    margin: 0 0 1.5rem 0;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-item {
    padding: 2rem 0;
    border-bottom: 1px solid var(--border-light);
  }

  .post-item:first-child {
    padding-top: 0;
  }

  .post-item:last-child {
    border-bottom: none;
  }

  .post-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .post-date {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--text-light);
  }

  .post-category {
    background: var(--bg-elevated);
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-muted);
  }

  .post-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 0.75rem 0;
    line-height: 1.3;
  }

  .post-title a {
    color: var(--text);
    text-decoration: none;
  }

  .post-title a:hover {
    color: var(--accent);
    text-decoration: none;
  }

  .post-excerpt {
    color: var(--text-muted);
    font-size: 1rem;
    line-height: 1.6;
    margin: 0 0 0.75rem 0;
  }

  .reading-time {
    font-size: 0.875rem;
    color: var(--text-light);
  }

  @media (max-width: 640px) {
    .intro {
      padding: 1.5rem 0 2rem;
    }

    .intro-title {
      font-size: 2rem;
    }

    .intro-text {
      font-size: 1rem;
    }

    .post-title {
      font-size: 1.25rem;
    }
  }
</style>
