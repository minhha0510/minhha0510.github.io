---
interface Props {
  paperTitle: string;
  paperUrl: string;
  topic: string;
}

const { paperTitle, paperUrl, topic } = Astro.props;

const prompt = `Hey! Got something cool for you—curious what you make of this: ${paperUrl}

It's a ${topic} but I want to understand it better.

Start with a tight summary: one paragraph, bulleted. Assume I have zero context—actually make sure I get it, not just skim the surface. Then offer to go deeper on what's most interesting or relevant to me.

(At some natural point later, not immediately, ask if I'd like you to remember to search)`;
---

<div class="explore-ai-container">
  <button
    class="explore-btn"
    data-prompt={prompt}
    aria-label="Copy AI prompt to explore this paper"
  >
    <svg class="explore-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
    </svg>
    <span class="explore-text">Explore with AI</span>
  </button>

  <div class="tooltip" id="copy-tooltip">Copied to clipboard!</div>
</div>

<style>
  .explore-ai-container {
    position: fixed;
    bottom: 1.5rem;
    right: 1.5rem;
    z-index: 50;
  }

  .explore-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 9999px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.15);
    transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
  }

  .explore-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
  }

  .explore-btn:active {
    transform: translateY(0);
  }

  .explore-icon {
    width: 20px;
    height: 20px;
  }

  .tooltip {
    position: absolute;
    bottom: 100%;
    right: 0;
    margin-bottom: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.875rem;
    color: var(--text);
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s, visibility 0.2s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .tooltip.show {
    opacity: 1;
    visibility: visible;
  }

  @media (max-width: 640px) {
    .explore-text {
      display: none;
    }

    .explore-btn {
      padding: 0.875rem;
      border-radius: 50%;
    }
  }
</style>

<script>
  const btn = document.querySelector('.explore-btn');
  const tooltip = document.getElementById('copy-tooltip');

  btn?.addEventListener('click', async () => {
    const prompt = btn.getAttribute('data-prompt');
    if (!prompt) return;

    try {
      await navigator.clipboard.writeText(prompt);
      tooltip?.classList.add('show');

      setTimeout(() => {
        tooltip?.classList.remove('show');
      }, 2000);
    } catch (err) {
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = prompt;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);

      tooltip?.classList.add('show');
      setTimeout(() => {
        tooltip?.classList.remove('show');
      }, 2000);
    }
  });
</script>
